Formalize a NormCode Draft Straightforward (.ncds) file into a formal NormCode Draft (.ncd).

The formalization algorithm processes each inference line-by-line while maintaining overall context. For each inference in the input .ncds file:

1. PARSE the .ncds file structure:
   - Extract each line with its marker (<-, <=, <*, /:, :<:)
   - Determine indentation level (4-space increments)
   - Build a parent-child tree structure
   - Identify the root concept (level 0)

2. For each inference, ADD FLOW INDEX:
   - Root gets index "1"
   - Children get parent index + "." + sibling number
   - All concept lines get indices (value, functional, and context)
   - Format: | ?{flow_index}: 1.2.3

3. For each functional concept (<=), DETERMINE SEQUENCE TYPE:
   - Check for syntactic operators first:
     * $= $. $+ $- $% → assigning
     * &[{}] &[#] → grouping
     * @:' @:! @. → timing
     * *. → looping
   - If no syntactic operator, check semantic patterns:
     * Action verbs (calculate, extract, process) → imperative
     * Evaluation phrases (is valid, check if, verify) → judgement
   - Format: | ?{sequence}: imperative

4. For each concept, ADD SEMANTIC TYPE:
   - Value concepts (<-):
     * Singular nouns → {name} (Object)
     * Plural nouns or "all X" → [name] (Relation)
     * Boolean phrases (is valid, passed) → <name> (Proposition)
   - Functional concepts (<=):
     * Commands/actions → ::(description)
     * Evaluations → ::(description)<ALL True>
   - Context concepts (<*) follow value concept rules

5. For multi-input operations, ADD VALUE BINDINGS:
   - Scan functional concept text for input references
   - Assign <:{1}>, <:{2}>, etc. to value concepts in order
   - Match concept names to operation text where possible
   - Format: <- {input A}<:{1}>

6. MARK ROOT concept:
   - Change root <- to :<:
   - Format: :<:{root concept}

7. PRESERVE comments and descriptions:
   - Keep /: lines intact
   - Maintain readability

Input: .ncds file (hierarchical structure without formal annotations)
Output: .ncd file (with flow indices, sequence types, semantic types, value bindings)

Processing approach: Inference-by-inference with global context maintained.


