{'refined_instruction': "NormCode Draft Formalizer:\n\nINPUT:\n- NormCode Draft Straightforward (.ncds) file containing concept lines and comments\n\nOUTPUT:\n- Formal NormCode Draft (.ncd) file with fully formatted lines including flow indices, semantic types, sequence types, value bindings, and proper syntax annotations (e.g., | ?{sequence}:)\n\nPROCESS:\n1. Parse the .ncds file into a JSON list of lines, where each line contains: flow_index, content, depth, inference_marker, and concept_type\n2. Filter out comment lines; retain only concept lines for processing\n3. For each concept line in the filtered list:\n   a. Classify the concept type from the following categories: {object}, [relation], <proposition>, imperative, judgement, assigning, grouping, timing, looping\n   b. Based on the classified type, apply the corresponding formal syntax rule:\n      - If {object}: format as '{concept} | ?{sequence}:'\n      - If [relation]: format as '[subject -> predicate -> object] | ?{sequence}:'\n      - If <proposition>: format as '<proposition> | ?{sequence}:'\n      - If imperative: format with action directive and binding\n      - If judgement: include evaluation criteria and outcome\n      - If assigning: bind value to variable with assignment syntax\n      - If grouping: wrap related concepts using grouping delimiters\n      - If timing: annotate with temporal constraints\n      - If looping: include iteration bounds and conditions\n   c. Generate the formally syntaxed version of the line with all required annotations\n4. Collect all formally syntaxed lines in order\n5. Serialize the collection into a single .ncd text file using the parser, preserving line sequence and structure\n\nINTERMEDIATE RESULTS:\n- Parsed JSON representation of all lines with metadata\n- Filtered list of non-comment concept lines\n- Concept type classification for each line\n- Individually formalized line content before serialization\n\nERROR HANDLING:\n- If a line cannot be parsed, skip it and continue with the next line\n- If a concept type cannot be determined, log a warning and omit the line from output\n- No partial writes: only produce output file if all steps complete successfully\n\nTERMINATION:\n- Process ends after all concept lines are formalized and serialized into the final .ncd file", 'structure': {'goal': 'Generate a formal .ncd file from a .ncds source by applying syntax rules based on concept type', 'inputs': ['.ncds file', 'line metadata (flow_index, content, depth, inference_marker, concept_type)'], 'outputs': ['.ncd file', 'formatted concept lines with syntax annotations', 'flow-indexed sequence with value bindings'], 'iterations': [{'collection': 'filtered concept lines (non-comments)', 'per_item': 'one formally syntaxed line with type-specific formatting'}], 'conditions': [{'condition': 'line is a comment', 'if_true': 'exclude from processing', 'if_false': 'proceed to concept type classification'}, {'condition': 'concept type is {object}', 'if_true': "apply object syntax: '{concept} | ?{sequence}:'"}, {'condition': 'concept type is [relation]', 'if_true': "apply relation syntax: '[subject -> predicate -> object] | ?{sequence}:'"}, {'condition': 'concept type is <proposition>', 'if_true': "apply proposition syntax: '<proposition> | ?{sequence}:'"}, {'condition': 'concept type is unrecognized', 'if_true': 'log warning, skip line'}], 'steps': ['parse .ncds file into JSON lines with metadata', 'filter out comment lines', 'classify concept type for each remaining line', 'apply type-specific formal syntax transformation', 'collect all formalized lines', 'serialize into final .ncd text format']}, 'patterns_used': ['linear', 'multi-input', 'iteration', 'conditional', 'grouping']}