### Step 2.3: Plan Formalization

**Objective:** To convert the annotated and semi-formal **NormCode Draft (`.ncd`)** into a clean, parsable **NormCode (`.nc`)** file. This is a critical preparatory step for context distribution and final script generation.

**Process:**

The formalization is an automated script that performs two key actions:

1.  **Stripping Annotations:** It removes all human-centric annotations (`?:`, `/:`, `...:`), which are essential for debugging the deconstruction but are noise for the execution engine.
2.  **Generating Flow Indices:** It walks the hierarchical structure of the plan and assigns a unique, dot-delimited `flow_index` (e.g., `1.3.2.2`) and an `agent sequence type` (e.g., `object`) to each line. This makes every single inference in the plan uniquely addressable.

---
### Example Walkthrough

This example shows how the annotated deconstruction of "Phase 1" is formalized into a machine-readable plan.

**1. Input (`2.1_deconstruction_draft.ncd` snippet):**

This is the version designed for human review, with questions, descriptions, and source text.

```normcode
<- {3.3_formalized.nc}
    <= ::{%(composition)}({prompt}<$({formalization prompt})%>: {1}<$({3.2_redirected.ncd})%>; {output}<$({output file location of formalization})%>)
    <- {formalization prompt}<:{prompt}>
        |%{prompt_location}: prompts/3.3_formalization.md
    <- {3.2_redirected.ncd}<:{1}>
    <- {output file location of formalization}<:{output}>
        |%{location_string}: 3.3_formalized.nc
```

**2. Formalization Script:**

The script processes the `.ncd` file, stripping the annotations and adding the `flow_index` and `agent sequence type` to each line.

**3. Output (`2.3_deconstruction.nc` snippet):**

This is the final, parsable output. Every line is now uniquely identified and ready to be mapped to a specific context.

```normcode
1.4.4.object_%{file_location}:3.3_formalized.nc|<- {3.3_formalized.nc}
1.4.4.1.imperative_::{%(composition)}|<= ({prompt}<$({formalization prompt})%>: {1}<$({3.2_redirected.ncd})%>; {output}<$({output file location of formalization})%>)
1.4.4.2.object_%{prompt_location}:prompts/3.3_formalization.md|<- {formalization prompt}<:{prompt}>
1.4.4.3.object|<- {3.2_redirected.ncd}<:{1}>
1.4.4.4.object_%{location_string}:3.3_formalized.nc|<- {output file location of formalization}<:{output}>
```
