# [context]

## [pipeline_goal_and_structure]
# The NormCode AI Planning Pipeline

## Project Goal

The project goal is to bootstrap from a high-level natural language prompt into a structured and executable plan using a meta-algorithmic pipeline. This pipeline, itself powered by a NormCode plan, methodically transforms an instruction by:

1.  **Distilling** the user's intent into a clean instruction and registering all raw context.
2.  **Deconstructing** the instruction into a formal, hierarchical NormCode plan (`.ncd`).
3.  **Formalizing** the plan by applying serialization and redirection patterns and generating a final `.nc` file.
4.  **Contextualizing** the plan by enriching each formal step with precise, granular context and assembling prompts.
5.  **Materializing** the final plan into an executable script, ready for an orchestrator.

This creates a system that can understand, decompose, contextualize, and act upon complex instructions in a transparent and repeatable manner.

## Core Inputs

Each iteration of the pipeline begins with two primary markdown files that define the scope and methodology of the task:

-   **`prompts/0_original_prompt.md`**: This file contains the high-level goal that is the target of the decomposition process. It defines the "what" that the pipeline needs to accomplish.
-   **`_meta_pipeline_prompt.md`**: This file documents the methodology used to bootstrap the entire process. It defines the "how" the decomposition and planning will be executed.

For the purpose of this project, these two files are kept synchronized and are updated dynamically through manual modifications to reflect the most current practices and understanding of the pipeline itself.

## The Five-Phase Pipeline

The pipeline is divided into five distinct phases, each with a specific objective:

1.  **Phase 1: Confirmation of Instruction**: Transforms the initial, conversational user prompt into a set of clean, structured inputs (an `Instruction Block` and an `Initial Context Registry`). This phase includes an opportunity for manual review to ensure accuracy.

2.  **Phase 2: Deconstruction into NormCode Plan**: Translates the clean `Instruction Block` into a semi-formal NormCode Draft (`.ncd`). This draft represents the logical structure of the plan and is designed for human review.

3.  **Phase 3: Plan Formalization and Redirection**: Applies serialization and redirection patterns to the plan and converts the `.ncd` draft into a formal `.nc` file with unique identifiers (`flow_index`) for each step.

4.  **Phase 4: Contextualization and Prompt Assembly**: Distributes context from a `context_store` to each step in the plan, generates a `context_registry.json`, and assembles the final prompt files.

5.  **Phase 5: Materialization into an Executable Script**: Translates the final, formalized `.nc` plan and its context map into a runnable Python script, ready for execution by an `Orchestrator`.

This structured, phased approach ensures that a high-level, ambiguous instruction can be methodically transformed into a precise, executable, and context-aware plan.

## [file_info-initial_context_registered-json]
# File Format: Initial Context Registered (`.json`)

The `1.2_initial_context_registered.json` file is a crucial input generated during Phase 1. It acts as the first machine-readable inventory of all the high-level, raw context materials available to the pipeline.

**Purpose:**
This file serves as a registry, or an index, for the unstructured knowledge contained in the `context_store/raw--*` files. It allows the system to understand what context is available before the more detailed context distribution in Phase 4. It maps human-readable descriptions of each knowledge source to its corresponding file.

**Format:**
It is a JSON object containing a `summary` and an array of `sections`. Each section object represents a single raw context file.

-   `summary`: A brief, high-level description of the overall context.
-   `sections`: An array of objects, where each object has:
    -   `title`: A human-readable title for the context document.
    -   `description`: A paragraph explaining the purpose and content of the referenced file.
    -   `file_reference`: The relative path to the raw context file within the `context_store`.

**Example Snippet:**
```json
{
  "summary": "This context block provides the high-level summary and references for the NormCode AI Planning Pipeline meta-algorithm...",
  "sections": [
    {
      "title": "Core Methodology and Examples",
      "description": "The primary methodology is a four-phase pipeline...",
      "file_reference": "./context_store/raw--prompt.txt"
    },
    {
      "title": "Technical Language Specification",
      "description": "The underlying semi-formal language used in the plan is NormCode...",
      "file_reference": "./context_store/raw--normcode_terminology_guide.txt"
    }
  ]
}
```
This file is essential for bootstrapping the pipeline's understanding of its own knowledge base.

## [file_info-context_store-dir]
# Directory Guide: context_store

The `context_store` is a directory that holds the "knowledge base" for the pipeline. It contains a variety of files, primarily Markdown (`.md`) but also plain text (`.txt`), which provide the necessary information and guidance for the AI to execute the steps of the NormCode plan.

**Purpose:**
The context store holds the "knowledge base" for the pipeline. Each file contains a specific piece of context—a procedure, a guide, a data format explanation, or a principle—that is required by one or more prompts during the plan's execution. This modular approach allows for precise context distribution, ensuring that each prompt receives only the information it needs.

**File Categories:**
The files within the directory are categorized by a naming prefix, which indicates their role. The full inventory of these files is referenced in `1.2_initial_context_registered.json` (for raw context) and `4.1_context_registry.json` (for refined, task-specific context). The categories are:

-   `shared--*.md`: These files contain context that is potentially relevant to many different steps across the pipeline (e.g., `shared---pipeline_goal_and_structure.md`).
-   `[flow_index]---*.md`: These files contain context that is highly specific to a single step in the plan, identified by its unique `flow_index` (e.g., `1.6.2.1---automated_script_generation.md`).
-   `raw--*.(md|txt)`: These files represent initial, unprocessed context registered at the beginning of the pipeline. They are intended to be analyzed or transformed into more refined context files, but are kept intact as a record of the original state.

**Role in the Pipeline:**
During Phase 4 (Contextualization), the system analyzes the plan and generates a `context_registry.json` file. This registry explicitly maps which files from the `context_store` are required for each prompt, enabling the final assembly of targeted, context-aware prompts.

---
# [TASK]

## [MAIN INSTRUCTION]
### Step 1.2: Automated Context Registration

Following the distillation of the instruction, the system identifies and registers all non-procedural information required for the plan. This "world knowledge" can come from various sources, including system context, constraints mentioned in the prompt, or a set of pre-existing authoritative documents.

The goal is to produce a structured registration registry that identifies and catalogs all relevant context files. This step focuses on:

1.  **File Identification:** Analyzing the input to identify which files should be registered in the `context_store`.
    -   **Mandatory:** The **Raw Prompt** (`$input_1`) must *always* be registered and mapped to `./context_store/raw--prompt.md`.
    -   **Discretionary:** Identify other files (e.g., technical guides, background info) from `Other Input Files` (`$input_other`) or references in the text.
2.  **Registry Generation:** Creating a structured JSON file that acts as a high-level summary and index. The registry provides human-readable titles and descriptions for each context file, along with their target paths in `context_store`.

**Note:** The actual file copying to `context_store` will be handled by a separate automated step. This LLM step focuses on the intelligent tasks of identification and description.

---
*From Project Context:*

#### **Example: Registering Authoritative Documents**

In many cases, the context is not a small piece of information but a collection of detailed documents that provide foundational knowledge. The registration process involves identifying references to these documents within the user prompt or system context, and then creating a registry that catalogs them.

-   **Input (User Prompt):** "Please execute the meta-pipeline as described in `prompt.md`. Use the `normcode_terminology_guide.md` for definitions and `file_formats_guide.md` for file specifications."

-   **LLM Process:** The model analyzes the prompt, identifies all mentioned file references, and creates a registry that summarizes the purpose of each document. The model also provides a mapping of source files to target paths in `context_store`.

-   **Output:** A JSON object containing:
    1.  **`analysis`**: Reasoning about which files were identified
    2.  **`answer`** with:
       - **`initial_context_registered.json`**: The complete registry structure
       - **`file_mapping.json`**: Mapping from source files to target paths
    ```json
    {
      "analysis": "Identified three authoritative documents referenced in the prompt: the main pipeline prompt, terminology guide, and file formats guide.",
      "answer": {
        "initial_context_registered.json": {
          "summary": "This context block provides the high-level summary and references for the NormCode AI Planning Pipeline...",
          "sections": [
            {
              "title": "Core Methodology and Examples",
              "description": "A complete, practical walkthrough of this pipeline...is provided in raw--prompt.md.",
              "file_reference": "./context_store/raw--prompt.md"
            },
            {
              "title": "Technical Language Specification",
              "description": "The complete technical reference for the language...is detailed in raw--normcode_terminology_guide.md.",
              "file_reference": "./context_store/raw--normcode_terminology_guide.md"
            },
            {
              "title": "File Format Specifications",
              "description": "The specifications for the various file formats...are detailed in raw--file_formats_guide.md.",
              "file_reference": "./context_store/raw--file_formats_guide.md"
            }
          ]
        },
        "file_mapping.json": {
          "prompt.md": "./context_store/raw--prompt.md",
          "normcode_terminology_guide.md": "./context_store/raw--normcode_terminology_guide.md",
          "file_formats_guide.md": "./context_store/raw--file_formats_guide.md"
        }
      }
    }
    ```

## [INPUT]

---

## Input

**Other Input Files:**
*Note: When provided, other input files will be formatted as XML-style tags with numbered file identifiers (e.g., `<file_1=file_path>...</file_1>`, `<file_2=file_path>...</file_2>`). Analyze these to determine if they should be registered as context.*

```xml
$input_other
```


**Raw Prompt (Mandatory Context):**
*Note: This content constitutes the primary instruction and MUST be registered as `raw--prompt.md`.*
```
$input_1
```


## [OUTPUT FORMAT]

**Your task:** Analyze the input to identify all context files that should be registered, and generate a registry that describes them. You do NOT need to copy files or provide file contents—only identify which files should be registered and create descriptive metadata for them.

**Output structure:** Return a JSON object with:
- **`analysis`**: Your reasoning about which files are relevant and why
- **`answer`**: A dictionary containing:
  - **`initial_context_registered.json`**: The complete JSON registry object (with `summary` and `sections` array)
  - **`file_mapping.json`**: A dictionary mapping source file paths (from input) to target paths in `context_store` (e.g., `{"prompt.md": "./context_store/raw--prompt.md"}`)

**Note:** The actual file copying will be handled by a separate automated step. Your job is to identify what should be copied and provide meaningful titles/descriptions for the registry.

Return only the JSON object, no additional text or formatting.
