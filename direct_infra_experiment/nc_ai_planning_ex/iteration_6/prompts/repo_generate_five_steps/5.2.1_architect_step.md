# Step 1: Architecture & Tool Selection (The Architect) - Single Inference Unit

**Role:** You are the Lead Architect for a NormCode execution plan. Your job is to transform an abstract "Inference Unit" into a concrete "Execution Specification" by selecting the exact tools (Paradigms) and resources (Prompts/Scripts) required.

**Input:**
1.  **Inference Unit:** A single JSON object from the `.nci.json` array (containing `concept_to_infer`, `function_concept`, and `value_concepts`).
2.  **Paradigm Manifest:** An XML-formatted library of available declarative function paradigms.
3.  **Context:** The implementation task description.

**Objective:**
Return the **exact same Inference Unit JSON**, but **enriched** with `attached_comments` inside the `function_concept` object. These comments must define the Paradigm and Resources.

---

## Paradigm Manifest

{{ body.paradigm_tool.list_manifest() }}

---

## Instructions

### 1. Analyze & Normalize
Examine `function_concept.nc_main` to determine if it is an explicit paradigm or a raw functional concept that needs normalization.

*   **Case A: Explicit Paradigm Placeholder**
    *   *Pattern:* `<= :%(Composition):{paradigm}(...)`
    *   *Action:* Proceed directly to Paradigm Selection.

*   **Case B: Raw Functional Concept (Imperative/Judgement)**
    *   **Imperative Pattern:** `::(...)` or a prefix implying action.
        *   *Example:* `<= ::(add five to the biggest number)`
    *   **Judgement Pattern:** `::<...>`
        *   *Example:* `<= ::<is this number prime>`
    *   **Subject Pattern:** `:xx:` (identifies a specific functional subject).
    *   **Action:** **Normalize the Unit** in your output.
        1.  **Rewrite Function:** Change `function_concept.nc_main` to the paradigm format: `<= :%(Composition):{paradigm}(<{nominalized_instruction}>)`.
        2.  **Extract Instruction:** Move the specific instruction text (the content inside `()` or `<>`) into `value_concepts` as a new input, wrapped in `%(...)`. Append `<:{nominalized_instruction}>` to explicitly bind this value to the function's argument.
            *   *New Value Concept:* `<- {%(add five to the biggest number)}<:{nominalized_instruction}>`

### 2. Select Paradigm
Choose the **exact filename** of the paradigm from the Manifest that best fits the intent of this inference step, based on the Context.
*   *Abstract Intent:* "Confirm instruction using a prompt and save the result."
*   *Selected Paradigm:* `h_PromptTemplateInputOther_SaveDir-c_GenerateThinkJson-Extract-Save-o_FileLocation`

### 3. Define Resources
Identify the necessary resource files based on the chosen paradigm's inputs (see `horizontal_inputs` and `vertical_inputs` in the manifest):
*   **Prompts:** If the paradigm requires a prompt (e.g., `prompt_template`), assign a specific file path (e.g., `prompts/1.1_instruction_distillation.md`).
*   **Scripts:** If the paradigm executes code (e.g., `script_location`), assign a script path.
*   **Output Paths:** Define where the results should be saved (e.g., `save_path`).

### 4. Enrich the JSON
Add strings to the `attached_comments` array inside `function_concept`. Use the standard metadata syntax:
*   `| %{paradigm}: <PARADIGM_NAME_WITHOUT_EXTENSION>`
*   `| %{prompt_location}: <PATH_TO_PROMPT>`
*   `| %{script_location}: <PATH_TO_SCRIPT>`
*   `| %{location_string}: <OUTPUT_PATH>`

### Example Transformation

**Input (Single Inference Unit):**
```json
{
  "concept_to_infer": { ... },
  "function_concept": {
    "flow_index": "1.2.2.1",
    "nc_main": "<= :%(Composition):{paradigm}(...)",
    "attached_comments": []
  },
  "value_concepts": [ ... ]
}
```

**Output (Enriched Unit):**
```json
{
  "concept_to_infer": { ... },
  "function_concept": {
    "flow_index": "1.2.2.1",
    "nc_main": "<= :%(Composition):{paradigm}(...)",
    "attached_comments": [
      "| %{paradigm}: h_PromptTemplateInputOther_SaveDir-c_GenerateThinkJson-Extract-Save-o_FileLocation",
      "| %{prompt_location}: prompts/1.1_instruction_distillation.md",
      "| %{location_string}: next_iteration/"
    ]
  },
  "value_concepts": [ ... ]
}
```

**Deliverable:** Return ONLY the single valid JSON object for the Enriched Inference Unit.
