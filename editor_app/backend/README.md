# NormCode Editor Backend

This backend provides the API for the NormCode Editor, a tool for creating, managing, and running NormCode repository sets. It is built with FastAPI.

## Project Structure

The backend is organized into the following directories:

-   `routers/`: Contains the FastAPI routers that define the API endpoints.
-   `schemas/`: Defines the Pydantic schemas used for data validation and serialization.
-   `services/`: Contains the business logic for managing repositories, concepts, and inferences, as well as for executing NormCode.
-   `tests/`: Contains the tests for the backend services and API endpoints.
-   `main.py`: The entry point for the FastAPI application.

## Setup and Installation

1.  **Create a virtual environment:**

    ```sh
    python -m venv venv
    ```

2.  **Activate the virtual environment:**

    -   **Windows:**
        ```sh
        .\venv\Scripts\activate
        ```
    -   **macOS/Linux:**
        ```sh
        source venv/bin/activate
        ```

3.  **Install the dependencies:**

    ```sh
    pip install -r requirements.txt
    ```

## Running the Application

To run the backend server, use the following command from the `editor_app/backend` directory:

```sh
uvicorn main:app --reload --port 8001
```

The API will be available at `http://127.0.0.1:8001`, and the interactive documentation (Swagger UI) can be accessed at `http://127.0.0.1:8001/docs`.

## API Endpoints

The API is organized around the following resources:

### Repository Management

-   `POST /api/repositories/`: Create a new repository set.
-   `GET /api/repositories/`: List all available repository sets.
-   `GET /api/repositories/{name}`: Retrieve a specific repository set definition.
-   `GET /api/repositories/{name}/data`: Retrieve the full data for a repository set, including all concepts and inferences.
-   `DELETE /api/repositories/{name}`: Delete a repository set and its associated data.

### Concept Management

-   `GET /api/repositories/{name}/concepts`: Get all concepts for a repository set.
-   `POST /api/repositories/{name}/concepts`: Add a new concept.
-   `GET /api/repositories/{name}/concepts/{concept_id}`: Get a single concept by ID.
-   `PUT /api/repositories/{name}/concepts/{concept_id}`: Update a concept.
-   `DELETE /api/repositories/{name}/concepts/{concept_id}`: Delete a concept.

### Inference Management

-   `GET /api/repositories/{name}/inferences`: Get all inferences for a repository set.
-   `POST /api/repositories/{name}/inferences`: Add a new inference.
-   `GET /api/repositories/{name}/inferences/{inference_id}`: Get a single inference by ID.
-   `PUT /api/repositories/{name}/inferences/{inference_id}`: Update an inference.
-   `DELETE /api/repositories/{name}/inferences/{inference_id}`: Delete an inference.

### Normcode Execution

-   `POST /api/repositories/run`: Run a repository set.
-   `GET /api/repositories/logs/{log_filename}`: Get the logs for a specific run.

## Storage Structure

All data is stored in the `editor_app/data` directory, which is ignored by Git. The data is organized as follows:

-   `data/repositories/`: Stores the JSON files that define the repository sets (containing IDs of concepts and inferences).
-   `data/concepts/`: Stores the JSON files that contain the concept entries for each repository set.
-   `data/inferences/`: Stores the JSON files that contain the inference entries for each repository set.
-   `data/logs/`: Stores the log files generated by NormCode executions.

## Running Tests

To run the tests, use `pytest` from the project root:

```sh
pytest editor_app/backend/tests/
```
