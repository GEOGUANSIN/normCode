{
  "env_spec": {
    "tools": [
      {
        "tool_name": "llm",
        "affordances": [
          {
            "affordance_name": "generate",
            "call_code": "result = tool.generate"
          }
        ]
      },
      {
        "tool_name": "composition_tool",
        "affordances": [
          {
            "affordance_name": "compose",
            "call_code": "result = tool.compose(plan=params['plan'], return_key=params.get('return_key'))"
          }
        ]
      },
      {
        "tool_name": "formatter_tool",
        "affordances": [
          {
            "affordance_name": "create_template_function",
            "call_code": "result = tool.create_template_function(template=params['template'])"
          },
          {
            "affordance_name": "clean_code",
            "call_code": "result = tool.clean_code"
          },
          {
            "affordance_name": "get",
            "call_code": "result = tool.get"
          },
          {
            "affordance_name": "identity",
            "call_code": "result = lambda x: x"
          }
        ]
      },
      {
        "tool_name": "file_system",
        "affordances": [
          {
            "affordance_name": "save",
            "call_code": "result = tool.save"
          },
          {
            "affordance_name": "read",
            "call_code": "result = tool.read"
          },
          {
            "affordance_name": "exists",
            "call_code": "result = tool.exists"
          }
        ]
      },
      {
        "tool_name": "python_interpreter",
        "affordances": [
          {
            "affordance_name": "function_execute",
            "call_code": "result = tool.function_execute"
          }
        ]
      }
    ]
  },
  "sequence_spec": {
    "steps": [
      {
        "step_index": 1,
        "affordance": "formatter_tool.create_template_function",
        "params": {
          "template": {
            "__type__": "MetaValue",
            "key": "states.inference.concept"
          }
        },
        "result_key": "template_fn"
      },
      {
        "step_index": 2,
        "affordance": "llm.generate",
        "params": {},
        "result_key": "generate_fn"
      },
      {
        "step_index": 3,
        "affordance": "formatter_tool.clean_code",
        "params": {},
        "result_key": "clean_code_fn"
      },
      {
        "step_index": 4,
        "affordance": "file_system.save",
        "params": {},
        "result_key": "save_fn"
      },
      {
        "step_index": 5,
        "affordance": "python_interpreter.function_execute",
        "params": {},
        "result_key": "function_execute_fn"
      },
      {
        "step_index": 6,
        "affordance": "formatter_tool.get",
        "params": {},
        "result_key": "dict_get_fn"
      },
      {
        "step_index": 7,
        "affordance": "file_system.read",
        "params": {},
        "result_key": "read_fn"
      },
      {
        "step_index": 8,
        "affordance": "file_system.exists",
        "params": {},
        "result_key": "exists_fn"
      },
      {
        "step_index": 9,
        "affordance": "formatter_tool.identity",
        "params": {},
        "result_key": "identity_fn"
      },
      {
        "step_index": 10,
        "affordance": "composition_tool.compose",
        "params": {
          "plan": [
            {
              "output_key": "script_inputs",
              "function": {
                "__type__": "MetaValue",
                "key": "dict_get_fn"
              },
              "params": {
                "dictionary": "__initial_input__"
              },
              "literal_params": {
                "key": "script_inputs"
              }
            },
            {
              "output_key": "script_location",
              "function": {
                "__type__": "MetaValue",
                "key": "dict_get_fn"
              },
              "params": {
                "dictionary": "__initial_input__"
              },
              "literal_params": {
                "key": "script_location"
              }
            },
            {
              "output_key": "script_exists",
              "function": {
                "__type__": "MetaValue",
                "key": "exists_fn"
              },
              "params": {
                "__positional__": "script_location"
              }
            },
            {
              "condition": {
                "key": "script_exists",
                "operator": "is_true"
              },
              "output_key": "read_result",
              "function": {
                "__type__": "MetaValue",
                "key": "read_fn"
              },
              "params": {
                "__positional__": "script_location"
              }
            },
            {
              "condition": {
                "key": "script_exists",
                "operator": "is_true"
              },
              "output_key": "code_to_run",
              "function": {
                "__type__": "MetaValue",
                "key": "dict_get_fn"
              },
              "params": {
                "dictionary": "read_result"
              },
              "literal_params": {
                "key": "content"
              }
            },
            {
              "output_key": "prompt_string",
              "condition": {
                "key": "script_exists",
                "operator": "is_false"
              },
              "function": {
                "__type__": "MetaValue",
                "key": "template_fn"
              },
              "params": {
                "__positional__": "script_inputs"
              }
            },
            {
              "output_key": "raw_llm_response",
              "condition": {
                "key": "script_exists",
                "operator": "is_false"
              },
              "function": {
                "__type__": "MetaValue",
                "key": "generate_fn"
              },
              "params": {
                "__positional__": "prompt_string"
              }
            },
            {
              "output_key": "clean_code",
              "condition": {
                "key": "script_exists",
                "operator": "is_false"
              },
              "function": {
                "__type__": "MetaValue",
                "key": "clean_code_fn"
              },
              "params": {
                "__positional__": "raw_llm_response"
              }
            },
            {
              "output_key": "save_confirmation",
              "condition": {
                "key": "script_exists",
                "operator": "is_false"
              },
              "function": {
                "__type__": "MetaValue",
                "key": "save_fn"
              },
              "params": {
                "content": "clean_code",
                "location": "script_location"
              }
            },
            {
              "condition": {
                "key": "script_exists",
                "operator": "is_false"
              },
              "output_key": "code_to_run",
              "function": {
                "__type__": "MetaValue",
                "key": "identity_fn"
              },
              "params": {
                "__positional__": "clean_code"
              }
            },
            {
              "output_key": "execution_result",
              "function": {
                "__type__": "MetaValue",
                "key": "function_execute_fn"
              },
              "params": {
                "script_code": "code_to_run",
                "function_params": "script_inputs"
              },
              "literal_params": {
                "function_name": "main"
              }
            }
          ],
          "return_key": "execution_result"
        },
        "result_key": "instruction_fn"
      }
    ]
  }
}
